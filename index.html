<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ChrionmlÂ© Map Smoke Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    html,body{height:100%;margin:0}
    #map{position:fixed;inset:0;width:100vw;height:100vh}
    #debug{position:fixed;left:0;right:0;bottom:0;background:#fee2e2;color:#991b1b;padding:8px 12px;font:12px/1.4 system-ui;display:none;z-index:10;white-space:pre-wrap;border-top:1px solid #fecaca}
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="debug"></div>
  <script>
    // 1) YOUR TOKEN (ensure Allowed URLs includes https://daramoladoes.github.io/*)
    mapboxgl.accessToken = 'pk.eyJ1Ijoib2QzIiwiYSI6ImNtZGV3a3FhMTA2dXkyanE1eHpiMGFzaHcifQ.SFRhIljjn0_VnQ6SoKnYIw';

    const styleURL = `https://api.mapbox.com/styles/v1/mapbox/light-v12?access_token=${mapboxgl.accessToken}`;

    function showError(msg){
      const el = document.getElementById('debug');
      el.textContent = `Map error: ${msg || '(no message)'}`;
      el.style.display = 'block';
    }

    // Probe style endpoint to surface token/domain issues early
    fetch(styleURL, {mode: 'cors'}).then(async r => {
      if (!r.ok) {
        showError(`Style fetch failed: HTTP ${r.status} ${r.statusText}`);
      }
      // No else: continue either way so Mapbox can emit its own errors too
    }).catch(err => showError(`Style fetch error: ${err?.message || err}`));

    if (!mapboxgl.supported()) {
      showError('This browser does not support Mapbox GL / WebGL.');
    } else {
      try {
        const map = new mapboxgl.Map({
          container: 'map',
          style: 'mapbox://styles/mapbox/light-v12',
          center: [-98.5795, 39.8283],
          zoom: 3,
          antialias: true
        });

        map.addControl(new mapboxgl.NavigationControl(), 'top-left');

        // Minimal error handler (no circular stringify)
        map.on('error', (e) => {
          const err = e && e.error;
          let msg = '(no message)';
          if (err) {
            if (typeof err.message === 'string') msg = err.message;
            else if (err.status || err.statusText) msg = `HTTP ${err.status || ''} ${err.statusText || ''}`.trim();
            else msg = String(err);
          }
          showError(msg);
          console.error('Mapbox error event:', e);
        });

        // Add a single marker on load to confirm render path works
        map.on('load', () => {
          new mapboxgl.Marker().setLngLat([-71.0589, 42.3601]).addTo(map); // Boston
        });

        // Resize safety
        addEventListener('resize', () => map.resize());

      } catch (err) {
        showError(err?.message || String(err));
        console.error('Init error:', err);
      }
    }

    // Global fallbacks
    window.onerror = (msg, src, line, col, err) => { showError(`${msg} @ ${src}:${line}:${col}`); };
    addEventListener('unhandledrejection', e => { showError(`Unhandled: ${e?.reason?.message || e.reason}`); });
  </script>
</body>
</html>
